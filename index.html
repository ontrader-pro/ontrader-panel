<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OnTrader Index Panel - Demo Funcional</title>
  <style>
    body { background: #101729; color: #fff; font-family: sans-serif; margin: 0; padding: 20px; }
    h1 { text-align: center; color: #25f0ff; margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    th, td { border: 1px solid #333; padding: 8px; text-align: center; }
    thead { background: #1f2a44; color: #25f0ff; }
    .high { color: limegreen; font-weight: bold; }
    .mid  { color: orange;    font-weight: bold; }
    .low  { color: red;       font-weight: bold; }
    #error-box { color: #f55; font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>OnTrader Index Panel - Demo Funcional</h1>
  <div id="panel">Cargando datos de prueba‚Ä¶</div>
  <div id="error-box"></div>

  <script type="module">
    // F√≥rmula matem√°tica del score:
    // x1 = 1 si precio < m√≠nimo domingo (minD), else 0
    // x2 = 1 si precio < EMA28, else 0
    // x3 = 1 si RSI14 < 50, else 0
    // x4 = 1 si RSI14 < 30, else 0
    // score = 1 + 2*x1 + 2*x2 + 3*x3 + 2*x4   => rango [1,10]
    export function calcScore({ price, minD, ema28, rsi14 }) {
      const x1 = price < minD ? 1 : 0;
      const x2 = price < ema28 ? 1 : 0;
      const x3 = rsi14 < 50   ? 1 : 0;
      const x4 = rsi14 < 30   ? 1 : 0;
      const raw = 1 + 2*x1 + 2*x2 + 3*x3 + 2*x4;
      return Math.min(10, Math.max(1, raw));
    }

    // Render table HTML a partir de datos
    export function renderTable(data) {
      let html = '<table>' +
        '<thead><tr><th>Symbol</th><th>Price</th><th>Score</th><th>Phase</th></tr></thead><tbody>';
      data.forEach(d => {
        const score = d.score.toFixed(2);
        let phase = 'üî¥ Oversold';
        if      (score >= 8.1) phase = 'üü¢ Overbought';
        else if (score >= 6.0) phase = 'üü° Bullish Incline';
        else if (score >= 4.9) phase = 'üü† Accumulation';
        else if (score >= 3.1) phase = 'üî¥ Bearish Incline';
        const cls = score >= 8  ? 'high' : score >= 5 ? 'mid' : 'low';
        html += `<tr>` +
                `<td>${d.symbol}</td>` +
                `<td>${d.price}</td>` +
                `<td class="${cls}">${score}</td>` +
                `<td>${phase}</td>` +
                `</tr>`;
      });
      html += '</tbody></table>';
      return html;
    }

    // Test cases b√°sicos
    function runTests() {
      const testData = [
        { symbol: 'BTC', price: 30000, minD: 29000, ema28: 29500, rsi14: 75 },  // Overbought
        { symbol: 'ETH', price: 1800,  minD: 1900,  ema28: 1850,  rsi14: 45 },  // Oversold
        { symbol: 'DOGE',price: 0.10,  minD: 0.09,  ema28: 0.11,  rsi14: 55 }   // Mid range
      ];
      console.assert(calcScore(testData[0]) >= 8, 'BTC debe ser Overbought');
      console.assert(calcScore(testData[1]) <= 3, 'ETH debe ser Oversold');
      console.assert(calcScore(testData[2]) > 4 && calcScore(testData[2]) < 6, 'DOGE debe ser mid');
      console.log('Tests calcScore pasados.');
    }

    // Datos de demostraci√≥n
    const demoData = [
      { symbol: 'BTC', price: 30000, minD: 29000, ema28: 29500, rsi14: 75 },
      { symbol: 'ETH', price: 1800,  minD: 1900,  ema28: 1850,  rsi14: 45 },
      { symbol: 'DOGE',price: 0.10,  minD: 0.09,  ema28: 0.11,  rsi14: 55 }
    ].map(d => ({ ...d, score: calcScore(d) }));

    // Inicializaci√≥n
    try {
      runTests();
      const panel = document.getElementById('panel');
      panel.innerHTML = renderTable(demoData);
    } catch (e) {
      document.getElementById('error-box').innerText = e.message;
    }
  </script>
</body>
</html>
